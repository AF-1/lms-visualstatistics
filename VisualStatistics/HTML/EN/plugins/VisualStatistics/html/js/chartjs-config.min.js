const xAxisData=[],yAxisData=[],labelExtraData=[],legendtext=[],subtitlelegendtext=[],yLabel=[],querytype=[],LMSdata={labels:xAxisData,datasets:[{data:yAxisData,axis:"y",label:yLabel}]};var palette=["rgb(180, 236, 158)","rgb(153, 194, 233)","rgb(251, 221, 124)","rgb(147, 185, 165)","rgb(186, 158, 242)","rgb(238, 196, 151)","rgb(108, 108, 240)","rgb(243, 223, 164)","rgb(220, 129, 121)","rgb(162, 221, 150)","rgb(142, 169, 206)","rgb(246, 224, 210)","rgb(163, 163, 164)","rgb(219, 201, 151)","rgb(208, 207, 209)"],myChartDoughnut,myChartBar,myChartLine,myChartBarStacked,isHorizontal=!0,defaultOrder=!0,maxLabelLength=30,legendTitleFontSize=20;Chart.register(ChartDataLabels);const actions=[{name:"Trigger Hover",handler:triggerHover}];function triggerHover(e){e.getActiveElements().length>0?e.setActiveElements([]):e.setActiveElements([{datasetIndex:0,index:0}]),e.update()}function round(t,n){var e=Math.pow(10,n||0);return Math.round(t*e)/e}function drawBarChart(t){var e=document.getElementById("chartCanvas").getContext("2d");destroyUsedCanvas(e);const n={type:"bar",data:LMSdata,options:{responsive:!0,datasets:{bar:{fill:!1,backgroundColor:["rgba(54, 162, 245, 0.5)"],borderWidth:0,hoverBackgroundColor:"rgba(54, 162, 245, 1)"}},plugins:{legend:{position:"top",onClick:null,labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"left",yAlign:"center",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){if(labelExtraData.length>0){var t=labelExtraData[e[0].dataIndex];return e[0].label+" -- "+t}return e[0].label},label:function(e){var t=e.dataset.label,n=round(parseFloat(e.dataset.data[e.dataIndex]),1);return t+": "+n}}},datalabels:{display:!1,anchor:"end",align:"end",clamp:!0,rotation:0,backgroundColor:null,borderWidth:0,formatter:function(e){return round(e,1)}}},indexAxis:"y",scales:{y:{grid:{display:!1},ticks:{callback:function(t){var e=this.getLabelForValue(t);return e.length>maxLabelLength?e.substr(0,maxLabelLength)+"...":e}},reverse:!1},x:{ticks:{precision:0},beginAtZero:!0}}}};myChartBar=new Chart(e,n),hideDatalabels(myChartBar,1),toggleColorScheme(myChartBar,"Bar"),t?SwitchToVertical():SwitchToHorizontal()}function drawBarTimeChart(){var e=document.getElementById("chartCanvas").getContext("2d");destroyUsedCanvas(e);const t={type:"bar",data:LMSdata,options:{responsive:!0,datasets:{bar:{fill:!1,backgroundColor:["rgba(54, 162, 245, 0.5)"],borderWidth:0,hoverBackgroundColor:"rgba(54, 162, 245, 1)"}},plugins:{legend:{position:"top",onClick:null,labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){if(labelExtraData.length>0){var t=labelExtraData[e[0].dataIndex];return e[0].label+" -- "+t}return e[0].label},label:function(e){var t=e.dataset.label,n=round(parseFloat(e.dataset.data[e.dataIndex]),1);return t+": "+n}}},datalabels:{display:!1,anchor:"end",align:"end",clamp:!0,rotation:0,backgroundColor:null,borderWidth:0,formatter:function(e){return round(e,1)}}},indexAxis:"x",scales:{x:{grid:{display:!1}},y:{ticks:{precision:0},beginAtZero:!0}}}};myChartBarTime=new Chart(e,t),hideDatalabels(myChartBarTime,1),toggleColorScheme(myChartBarTime,"BarTime")}function drawDoughnutChart(){var e=document.getElementById("chartCanvas").getContext("2d");e.height=700,destroyUsedCanvas(e);function t(t){const e=t.replace(/ /g,'').slice(4,-1).split(",").map(e=>parseInt(e)),n=Math.max(...e),s=Math.min(...e);return(n+s)/2/255}function n(s){let e={val:-1,index:-1},t={val:1/0,index:-1};s.map((n,s)=>{n>e.val&&(e={val:n,index:s}),n<t.val&&(t={val:n,index:s})}),t.index===e.index&&(t.index=e.index+1);let n={index:3-e.index-t.index};return n.val=s[n.index],[t,n,e]}function s(a){const l=a.replace(/ /g,'').slice(4,-1).split(",").map(e=>parseInt(e)),e=t(a)*255,[i,c,s]=n(l);if(i.val===s.val)return a;const d=Math.round(Math.min(255-e,e)),u=Math.min(255-s.val,i.val),r=Math.min(d/.03,u),h=(e-c.val)/(e-s.val),o=[];return o[s.index]=Math.round(s.val+r),o[i.index]=Math.round(i.val-r),o[c.index]=Math.round(e+(o[s.index]-e)*h),`rgb(${[o].join()})`}const o={type:"doughnut",data:LMSdata,options:{responsive:!0,aspectRatio:16/8,cutout:"55%",datasets:{doughnut:{fill:!1,backgroundColor:function(e){return palette[e.dataIndex%palette.length]},borderWidth:0}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{enabled:!1,external:function(i){if(e=document.getElementById("chartjs-tooltip"),t=i.tooltip,t.opacity===0){e.style.opacity=0;return}function d(e){return e.lines}if(t.body){f=t.title||[],m=t.body.map(d);let i=0;LMSdata.datasets[0].data.forEach(e=>{i+=e});const g=s(t.labelColors[0].backgroundColor),p=LMSdata.datasets[0].data[t.dataPoints[0].dataIndex],v=round(p*100/i,1)+"%";var e,t,f,m,r=t.body[0].lines[0],c=r.split(": "),n,h,l=c[0].trim(),o=document.getElementById("chartCanvas").getContext("2d"),u=o.canvas.clientWidth,a=o.canvas.clientHeight;e.style.background="rgba(0, 0, 0, 0.7)",e.style.borderRadius="3px",e.style.color="white",e.style.opacity=1,e.style.pointerEvents="none",e.style.left=Math.round((u-e.clientWidth+20)/2)+"px",e.style.top=Math.round((a-e.clientHeight+50+41)/2)+"px",n='<tbody class="doughnutTable"><tr><td style="color:'+g+' !important;">'+l+"</td></tr>",n+='<tr><td class="vstats-doughnuttdcolor">'+p+"</td></tr>",n+='<tr><td class="vstats-doughnuttdcolor">'+v+"</td></tr></tbody>",h=e.querySelector("table"),h.innerHTML=n}}},datalabels:{backgroundColor:null,borderColor:"black",borderWidth:0,color:"black",display:!1,formatter:function(e,t){var n=0,s,e;LMSdata.datasets[0].data.forEach(e=>{n+=e}),s=t.dataset,e=s.data[t.dataIndex];const o=round(e*100/n,1);return o>1?e:''},rotation:function(s){var t=s.dataset,e,c,l,d,n,o,i=t.data.reduce(function(e,t){return e+t},0),h=t.data.length,r=s.dataIndex,u=t.data[s.dataIndex],a=0;for(e=0;e<r+1;e++)c=t.data[e],a+=c;return l=u/i*360/2,d=a/i*360,n=d-l,o=0,n<=180?o=n-90:o=n-90-180,o},anchor:"center"}}}};myChartDoughnut=new Chart(e,o),hideDatalabels(myChartDoughnut,1),toggleColorScheme(myChartDoughnut,"Doughnut")}function drawLineChart(e){var t=document.getElementById("chartCanvas").getContext("2d");destroyUsedCanvas(t);const n={type:"line",data:LMSdata,options:{responsive:!0,datasets:{line:{borderColor:"rgba(54, 162, 245, 1)",backgroundColor:"rgba(54, 162, 245, 0.5)",fill:!0,pointBackgroundColor:"#fff",radius:3,cubicInterpolationMode:"monotone",tension:.4}},plugins:{legend:{position:"top",onClick:null,labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){return languageStrings.VLchartlabelBitrate+": "+e[0].label+" kbps"},label:function(e){var t=e.dataset.label,n=round(parseFloat(e.dataset.data[e.dataIndex]),1);return t+": "+n}}},datalabels:{display:!1}},indexAxis:"x",scales:{x:{grid:{display:!1}},y:{ticks:{precision:0}}}}};myChartLine=new Chart(t,n),e=="listeningtimes"&&(myChartLine.config.options.plugins.tooltip={mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){return languageStrings.VLchartlabelListeningTime+": "+e[0].label+"h"},label:function(e){var t=e.dataset.label,n=e.dataset.data[e.dataIndex];return t+": "+n}}}),e=="fileSize"&&(myChartLine.config.options.plugins.tooltip={mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){return languageStrings.VLchartlabelFileSize+": "+e[0].label},label:function(e){var t=e.dataset.label,n=e.dataset.data[e.dataIndex];return t+": "+n}}}),toggleColorScheme(myChartLine,"Line")}function drawStackedBarChartBitRate(r,n){var s=document.getElementById("chartCanvas").getContext("2d"),i,t,e,o,c;destroyUsedCanvas(s),i={labels:["<192","192-255","256-319","320-499","500-699","700-999","1000-1200",">1200",languageStrings.VLchartlabelNoBitrate],datasets:[]};const a={type:"bar",data:i,options:{responsive:!0,datasets:{bar:{fill:!1,borderWidth:0}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:-5,caretSize:8,callbacks:{title:function(e){return languageStrings.VLchartlabelBitrate+": "+e[0].label+" kbps"},label:function(e){var n=e.dataset.label,t=e.formattedValue;return n+": "+t+(t==1?" "+languageStrings.VLchartlabelTrack:" "+languageStrings.VLchartlabelTracks)}}},datalabels:{display:!1}},indexAxis:"x",scales:{x:{stacked:!0,grid:{display:!1},ticks:{maxRotation:0}},y:{stacked:!0,ticks:{precision:0},beginAtZero:!0}}}};t=new Chart(s,a);for(e=0;e<n.length;e++)o=n[e],c={label:o,data:r,parsing:{yAxisKey:o}},t.config.data.datasets.push(c),t.config.data.datasets[e].backgroundColor=palette[e%palette.length];toggleColorScheme(t,"BarStacked"),t.update()}function drawStackedBarChart(n,s){var o=document.getElementById("chartCanvas").getContext("2d"),t,e,i,r;destroyUsedCanvas(o);const a={type:"bar",data:n,options:{responsive:!0,datasets:{bar:{fill:!1,borderWidth:0}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:-5,caretSize:8,callbacks:{title:function(e){return languageStrings.VLchartlabelFileSize+": "+e[0].label+" MB"},label:function(e){var n=e.dataset.label,t=e.formattedValue;return n+": "+t+(t==1?" "+languageStrings.VLchartlabelTrack:" "+languageStrings.VLchartlabelTracks)}}},datalabels:{display:!1}},indexAxis:"x",scales:{x:{stacked:!0,grid:{display:!1},ticks:{maxRotation:0}},y:{stacked:!0,ticks:{precision:0},beginAtZero:!0}}}};t=new Chart(o,a);for(e=0;e<s.length;e++)i=s[e],r={label:i,data:n,parsing:{yAxisKey:i}},t.config.data.datasets.push(r),t.config.data.datasets[e].backgroundColor=palette[e%palette.length];toggleColorScheme(t,"BarStacked"),t.update()}function drawScatterChart(a,r,s,o){var i=document.getElementById("chartCanvas").getContext("2d"),t,n,e,c,l;if(destroyUsedCanvas(i),o=="extraLabel"?(t=LMSdata,n={type:"scatter",data:t,options:{responsive:!0,datasets:{scatter:{pointRadius:7,pointRadiusBorderWidth:0,pointHoverBorderWidth:0,pointHoverRadius:7,backgroundColor:["rgba(54, 162, 245, 0.5)"],hoverBackgroundColor:"rgba(54, 162, 245, 1)"}},plugins:{legend:{position:"top",onClick:null,labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){var n=round(parseFloat(e[0].label.replace(/,/,".")),1),t=round(parseFloat(e[0].formattedValue.replace(/,/,".")),1),s=languageStrings.VLchartlabelAveragePlayCountShort+": "+n+"\n",o=languageStrings.VLchartlabelAverageArtistRating+": "+t+(t==1?" "+languageStrings.VLchartlabelStar:" "+languageStrings.VLchartlabelStars)+"\n____________________";return s+o},label:function(e){return labelExtraData[e.dataIndex]}}},datalabels:{display:!1}},indexAxis:"x",scales:{x:{grid:{display:!1},title:{display:!0,text:languageStrings.VLchartlabelAveragePlayCountShort}},y:{ticks:{precision:0},title:{display:!0,text:languageStrings.VLchartlabelAverageRating},beginAtZero:!0}}}}):(t={labels:r,datasets:[]},n={type:"scatter",data:t,options:{responsive:!0,datasets:{scatter:{pointRadius:7,pointRadiusBorderWidth:0,pointHoverBorderWidth:0,pointHoverRadius:7}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:languageStrings.subtitleScatterFileFormats},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!0,callbacks:{title:function(e){return languageStrings.VLchartlabelBitrate+": "+e[0].label+" kbps"},label:function(e){var n=e.dataset.label,t=e.formattedValue;return n+": "+t+(t==1?" "+languageStrings.VLchartlabelTrack:" "+languageStrings.VLchartlabelTracks)}}},datalabels:{display:!1}},indexAxis:"x",scales:{x:{grid:{display:!1}},y:{ticks:{precision:0},beginAtZero:!0}}}}),myChartScatter=new Chart(i,n),o!="extraLabel")for(e=0;e<s.length;e++)c=s[e],l={label:c,data:a[e]},myChartScatter.config.data.datasets.push(l),myChartScatter.config.data.datasets[e].backgroundColor=palette[e%palette.length];toggleColorScheme(myChartScatter,"Line"),myChartScatter.update()}function updateConfigAsNewObjectHorizontal(e){e.options={responsive:!0,datasets:{bar:{fill:!1,backgroundColor:["rgba(54, 162, 245, 0.5)"],borderWidth:0,hoverBackgroundColor:"rgba(54, 162, 245, 1)"}},plugins:{legend:{position:"top",onClick:null,labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"left",yAlign:"center",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){if(labelExtraData.length>0){var t=labelExtraData[e[0].dataIndex];return e[0].label+" -- "+t}return e[0].label},label:function(e){var t=e.dataset.label,n=round(parseFloat(e.dataset.data[e.dataIndex]),1);return t+": "+n}}},datalabels:{display:myChartBar.options.plugins.datalabels.display,anchor:"end",align:"end",clamp:!0,rotation:0,backgroundColor:null,borderWidth:0,formatter:function(e){return round(e,1)}}},indexAxis:"y",scales:{y:{grid:{display:!1},ticks:{callback:function(t){var e=this.getLabelForValue(t);return e.length>maxLabelLength?e.substr(0,maxLabelLength)+"...":e}},reverse:!1},x:{ticks:{precision:0},beginAtZero:!0}}},e.update()}function updateConfigAsNewObjectVertical(e){e.options={responsive:!0,datasets:{bar:{fill:!1,backgroundColor:["rgba(54, 162, 245, 0.5)"],borderWidth:0,hoverBackgroundColor:"rgba(54, 162, 245, 1)"}},plugins:{legend:{position:"top",onClick:null,labels:{usePointStyle:!0,boxWidth:9}},title:{display:!0,text:legendtext,font:{size:legendTitleFontSize}},subtitle:{display:!0,text:subtitlelegendtext},tooltip:{mode:"nearest",xAlign:"center",yAlign:"bottom",caretPadding:4,caretSize:8,displayColors:!1,callbacks:{title:function(e){if(labelExtraData.length>0){var t=labelExtraData[e[0].dataIndex];return e[0].label+" -- "+t}return e[0].label},label:function(e){var t=e.dataset.label,n=round(parseFloat(e.dataset.data[e.dataIndex]),1);return t+": "+n}}},datalabels:{display:myChartBar.options.plugins.datalabels.display,anchor:"end",align:"end",clamp:!0,rotation:-90,backgroundColor:null,borderWidth:0,formatter:function(e){return round(e,1)}}},indexAxis:"x",scales:{x:{grid:{display:!1},ticks:{callback:function(t){var e=this.getLabelForValue(t);return e.length>maxLabelLength?e.substr(0,maxLabelLength)+"...":e},maxRotation:90,minRotation:60,reverse:!1}},y:{ticks:{precision:0},beginAtZero:!0}}},e.update()}function SwitchToVertical(){updateConfigAsNewObjectVertical(myChartBar),document.getElementById("togglebtn_layout").innerHTML=languageStrings.buttonLayoutSwitchToHorizontal,isHorizontal=!1,document.getElementById("togglebtn_order").innerHTML=languageStrings.buttonOrderReverse,defaultOrder=!0,myChartBar.options.scales.y.reverse=!1,myChartBar.options.scales.x.reverse=!1}function SwitchToHorizontal(){updateConfigAsNewObjectHorizontal(myChartBar),document.getElementById("togglebtn_layout").innerHTML=languageStrings.buttonLayoutSwitchToVertical,isHorizontal=!0,document.getElementById("togglebtn_order").innerHTML=languageStrings.buttonOrderReverse,defaultOrder=!0,myChartBar.options.scales.y.reverse=!1,myChartBar.options.scales.x.reverse=!1}function reverseOrder(){defaultOrder?(document.getElementById("togglebtn_order").innerHTML=languageStrings.buttonOrderRestoreDefault,isHorizontal?myChartBar.options.scales.y.reverse=!0:myChartBar.options.scales.x.reverse=!0,defaultOrder=!1):(document.getElementById("togglebtn_order").innerHTML=languageStrings.buttonOrderReverse,isHorizontal?myChartBar.options.scales.y.reverse=!1:myChartBar.options.scales.x.reverse=!1,defaultOrder=!0),myChartBar.update()}function hideDatalabels(e,n){var s=n||0,t="togglebtn_datalabels";e.options.plugins.datalabels.display||s==1?(document.getElementById(t).innerHTML=languageStrings.buttonLabelsShow,e.options.plugins.datalabels.display=!1):(document.getElementById(t).innerHTML=languageStrings.buttonLabelsHide,e.options.plugins.datalabels.display=!0),e.update()}function destroyUsedCanvas(t){var e=Chart.getChart(t);typeof e!="undefined"&&e.destroy()}function toggleColorScheme(e,s){if(colorSchemeLight===!1&&Chart.defaults.color!=="rgba(235, 235, 235, 0.1)"){Chart.defaults.borderColor="rgba(235, 235, 235, 0.1)",Chart.defaults.color="rgba(235, 235, 235, 1)",e.options.scales.x={color:"rgba(235, 235, 235, 1)",precision:0,beginAtZero:!0},e.options.scales.y={color:"rgba(235, 235, 235, 1)"};for(var n=document.getElementsByClassName("overlay"),t=0;t<n.length;t++)n[t].style.backgroundColor="rgba(39, 38, 37, 1)";document.getElementById("colorscheme_value").innerHTML=languageStrings.colorSchemeDark,displayGridLines(e,s)}if(colorSchemeLight===!0&&Chart.defaults.color!=="#666"){Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.color="#666",e.options.scales.x={color:"#666",precision:0,beginAtZero:!0},e.options.scales.y={color:"#666"},n=document.getElementsByClassName("overlay");for(t=0;t<n.length;t++)n[t].style.backgroundColor="rgba(240, 240, 240, 1)";document.getElementById("colorscheme_value").innerHTML=languageStrings.colorSchemeLight,displayGridLines(e,s)}e.update()}function displayGridLines(e,t){t==="Bar"&&(e.options.scales.y={grid:{display:!1}}),t==="BarTime"&&(e.options.scales.y={ticks:{precision:0},beginAtZero:!0},e.options.scales.x={grid:{display:!1}}),t==="Doughnut"&&(e.options.scales.x={display:!1},e.options.scales.y={display:!1}),t==="Line"&&(e.options.scales.x={grid:{display:!1}}),t==="BarStacked"&&(e.options.scales.x={grid:{display:!1},stacked:!0},e.options.scales.y={stacked:!0})}