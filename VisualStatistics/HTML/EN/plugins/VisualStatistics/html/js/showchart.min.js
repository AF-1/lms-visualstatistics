const loader=document.createElement('span');loader.id="loader";loader.innerHTML=`	<div class="bar bar1"></div>	<div class="bar bar2"></div>	<div class="bar bar3"></div>	<div class="bar bar4"></div>	<div class="bar bar5"></div>	<div class="bar bar6"></div>	<div class="bar bar7"></div>	<div class="bar bar8"></div>`;const failed=document.createElement('span');failed.id="failed";failed.innerHTML=`<div class="failedicon"></div>`;function closeNav(){document.getElementById("myNavChart").style.width="0%";document.getElementById("myNavText").style.width="0%";document.getElementById("button_container").style.display="none";document.getElementById("container_togglebtn_layout").style.display="flex";document.getElementById("container_togglebtn_order").style.display="flex";document.getElementById("container_togglebtn_datalabels").style.display="flex";document.getElementById("chartjs-tooltip").style.display="none";}function openNav(chartType){if(chartType=="Text"){document.getElementById("myNavText").style.width="100%";}else{document.getElementById("myNavChart").style.width="100%";}}function displayChart(chartType,customValue){async function fetchData(){var existingNode=document.getElementById(querytype.join());existingNode.parentNode.insertBefore(loader,existingNode.nextSibling);const url="/plugins/VisualStatistics/getdata.html";let response=await fetch(url,{method:"post",headers:{"Content-Type":"application/json","Origin":window.location.hostname},body:querytype});if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}return await response.json();}fetchData().then((jsonData)=>{if(chartType=='BarStacked'){var StackedLMSData=[];for(var i=0;i<jsonData.results[0].length;i++){var thisPart=JSON.parse(jsonData.results[0][i]);StackedLMSData.push(thisPart);}var fileFormats=jsonData.results[1];drawStackedBarChart(StackedLMSData,fileFormats);}else if(chartType=='Scatter'){var StackedLMSData=[];for(var i=0;i<jsonData.results[0].length;i++){var thisPart=JSON.parse(jsonData.results[0][i]);StackedLMSData.push(thisPart);}var bitRates=jsonData.results[1];var fileFormats=jsonData.results[2];drawScatterChart(StackedLMSData,bitRates,fileFormats);}else if(chartType=='ScatterExtra'){for(var i=0;i<jsonData.results.length;i++){var counter=jsonData.results[i];xAxisData.push(counter.xAxis);yAxisData.push(counter.yAxis);if(counter.labelExtra&&counter.labelExtra.length>0){labelExtraData.push(unescape(counter.labelExtra));}}drawScatterChart(StackedLMSData,StackedLMSData,StackedLMSData,'extraLabel');}else if(chartType=='Text'){var tableRoot=document.getElementById("libstatstext");var innerHtml='<tbody class="libstatsTableBody">';for(var i=0;i<jsonData.results.length;i++){var thisName=jsonData.results[i].name;var thisValue=jsonData.results[i].value;innerHtml+='<tr><td class="vstats-tdcolor">'+thisName+'</td><td class="vstats-tdcolor">'+thisValue+'</td></tr>';}innerHtml+='</tbody>';tableRoot.innerHTML=innerHtml;toggleColorSchemeTextOverlay();}else{for(var i=0;i<jsonData.results.length;i++){var counter=jsonData.results[i];xAxisData.push(unescape(counter.xAxis));yAxisData.push(counter.yAxis);if(counter.labelExtra&&counter.labelExtra.length>0){labelExtraData.push(unescape(counter.labelExtra));}}if(chartType=='Line'){drawLineChart(customValue);}else if(chartType=='Doughnut'){document.getElementById("button_container").style.display="flex";document.getElementById("container_togglebtn_layout").style.display="none";document.getElementById("container_togglebtn_order").style.display="none";document.getElementById("container_togglebtn_datalabels").style.display="inline-block";document.getElementById("chartjs-tooltip").style.display="inline-block";drawDoughnutChart();}else if(chartType=='BarTime'){drawBarTimeChart();}else{document.getElementById("button_container").style.display="flex";drawBarChart(customValue);}}}).then(function(){openNav(chartType);var loaderEl=document.getElementById("loader");loaderEl.parentNode.removeChild(loaderEl);}).catch(function(error){console.log(error);var loaderEl=document.getElementById("loader");loaderEl.parentNode.removeChild(loaderEl);var existingNode=document.getElementById(querytype.join());existingNode.parentNode.insertBefore(failed,existingNode.nextSibling);});}function showChart(type){if(querytype.length!=0){legendtext.length=0;yLabel.length=0;querytype.length=0;xAxisData.length=0;yAxisData.length=0;labelExtraData.length=0;}if(type=='getDataArtistWithMostTracks'){legendtext.push('Artists with most tracks');yLabel.push('number of tracks');querytype.push('getDataArtistWithMostTracks');displayChart('Bar');}if(type=='getDataArtistWithMostAlbums'){legendtext.push('Album artists with most albums (no compilations)');yLabel.push('number of albums');querytype.push('getDataArtistWithMostAlbums');displayChart('Bar');}if(type=='getDataArtistWithMostRatedTracks'){legendtext.push('Artists with most rated tracks');yLabel.push('number of rated tracks');querytype.push('getDataArtistWithMostRatedTracks');displayChart('Bar');}if(type=='getDataArtistsWithTopRatedTracksAll'){legendtext.push('Artists with top average rated tracks (incl. unrated tracks)');yLabel.push('average track rating (stars)');querytype.push('getDataArtistsWithTopRatedTracksAll');displayChart('Bar');}if(type=='getDataArtistsWithTopRatedTracksRatedOnly'){legendtext.push('Artists with top average rated tracks (rated tracks only)');yLabel.push('average track rating (stars)');querytype.push('getDataArtistsWithTopRatedTracksRatedOnly');displayChart('Bar');}if(type=='getDataArtistsWithMostPlayedTracks'){legendtext.push('Artists with most played tracks (number of all tracks played at least once)');yLabel.push('number of tracks');querytype.push('getDataArtistsWithMostPlayedTracks');displayChart('Bar');}if(type=='getDataArtistsWithMostPlayedTracksAverage'){legendtext.push('Artists with most played tracks (highest average playcount)');yLabel.push('average playcount');querytype.push('getDataArtistsWithMostPlayedTracksAverage');displayChart('Bar');}if(type=='getDataArtistsRatingPlaycount'){legendtext.push('Artists - average rating vs. average playcount');yLabel.push('average rating/play count for artist');querytype.push('getDataArtistsRatingPlaycount');displayChart('ScatterExtra');}if(type=='getDataAlbumsByYear'){legendtext.push('Albums by year');yLabel.push('number of albums');querytype.push('getDataAlbumsByYear');displayChart('Bar','vertical');}if(type=='getDataAlbumsWithMostTracks'){legendtext.push('Albums with most tracks');yLabel.push('number of tracks');querytype.push('getDataAlbumsWithMostTracks');displayChart('Bar');}if(type=='getDataAlbumsWithMostRatedTracks'){legendtext.push('Albums with most rated tracks');yLabel.push('number of rated tracks');querytype.push('getDataAlbumsWithMostRatedTracks');displayChart('Bar');}if(type=='getDataAlbumsWithTopRatedTracksAll'){legendtext.push('Albums with top average rated tracks (incl. unrated tracks)');yLabel.push('average track rating (stars)');querytype.push('getDataAlbumsWithTopRatedTracksAll');displayChart('Bar');}if(type=='getDataAlbumsWithTopRatedTracksRatedOnly'){legendtext.push('Albums with top average rated tracks (rated tracks only)');yLabel.push('average track rating (stars)');querytype.push('getDataAlbumsWithTopRatedTracksRatedOnly');displayChart('Bar');}if(type=='getDataAlbumsWithMostPlayedTracks'){legendtext.push('Albums with most played tracks (number of all tracks played at least once)');yLabel.push('number of tracks');querytype.push('getDataAlbumsWithMostPlayedTracks');displayChart('Bar');}if(type=='getDataAlbumsWithMostPlayedTracksAverage'){legendtext.push('Albums with most played tracks (highest average playcount)');yLabel.push('average playcount');querytype.push('getDataAlbumsWithMostPlayedTracksAverage');displayChart('Bar');}if(type=='getDataGenresWithMostTracks'){legendtext.push('Genres with most tracks');yLabel.push('number of tracks');querytype.push('getDataGenresWithMostTracks');displayChart('Bar');}if(type=='getDataGenresWithMostAlbums'){legendtext.push('Genres with most albums');yLabel.push('number of albums');querytype.push('getDataGenresWithMostAlbums');displayChart('Bar');}if(type=='getDataGenresWithMostRatedTracks'){legendtext.push('Genres with most rated tracks');yLabel.push('number of rated tracks');querytype.push('getDataGenresWithMostRatedTracks');displayChart('Bar');}if(type=='getDataGenresWithTopRatedTracksAll'){legendtext.push('Genres with top average rated tracks (incl. unrated tracks)');yLabel.push('average track rating (stars)');querytype.push('getDataGenresWithTopRatedTracksAll');displayChart('Bar');}if(type=='getDataGenresWithTopRatedTracksRatedOnly'){legendtext.push('Genres with top average rated tracks (rated tracks only)');yLabel.push('average track rating (stars)');querytype.push('getDataGenresWithTopRatedTracksRatedOnly');displayChart('Bar');}if(type=='getDataGenresWithMostPlayedTracks'){legendtext.push('Genres with most played tracks (number of all tracks played at least once)');yLabel.push('number of tracks');querytype.push('getDataGenresWithMostPlayedTracks');displayChart('Bar');}if(type=='getDataGenresWithMostPlayedTracksAverage'){legendtext.push('Genres with most played tracks (highest average playcount)');yLabel.push('average playcount');querytype.push('getDataGenresWithMostPlayedTracksAverage');displayChart('Bar');}if(type=='getDataGenresWithTopAverageBitrate'){legendtext.push('Genres with top average bit rate (kbps)');yLabel.push('average bit rate (kbps)');querytype.push('getDataGenresWithTopAverageBitrate');displayChart('Bar');}if(type=='getDataTracksByYear'){legendtext.push('Tracks by year');yLabel.push('number of tracks');querytype.push('getDataTracksByYear');displayChart('Bar','vertical');}if(type=='getDataYearsWithMostTracks'){legendtext.push('Years with most tracks');yLabel.push('number of tracks');querytype.push('getDataYearsWithMostTracks');displayChart('Bar');}if(type=='getDataYearsWithMostAlbums'){legendtext.push('Years with most albums');yLabel.push('number of albums');querytype.push('getDataYearsWithMostAlbums');displayChart('Bar');}if(type=='getDataYearsWithMostRatedTracks'){legendtext.push('Years with most rated tracks');yLabel.push('number of rated tracks');querytype.push('getDataYearsWithMostRatedTracks');displayChart('Bar');}if(type=='getDataYearsWithTopRatedTracksAll'){legendtext.push('Years with top average rated tracks (incl. unrated tracks)');yLabel.push('average track rating (stars)');querytype.push('getDataYearsWithTopRatedTracksAll');displayChart('Bar');}if(type=='getDataYearsWithTopRatedTracksRatedOnly'){legendtext.push('Years with top average rated tracks (rated tracks only)');yLabel.push('average track rating (stars)');querytype.push('getDataYearsWithTopRatedTracksRatedOnly');displayChart('Bar');}if(type=='getDataYearsWithMostPlayedTracks'){legendtext.push('Years with most played tracks (number of all tracks played at least once)');yLabel.push('number of tracks');querytype.push('getDataYearsWithMostPlayedTracks');displayChart('Bar');}if(type=='getDataYearsWithMostPlayedTracksAverage'){legendtext.push('Years with most played tracks (highest average playcount)');yLabel.push('average playcount');querytype.push('getDataYearsWithMostPlayedTracksAverage');displayChart('Bar');}if(type=='getDataDecadesWithMostPlayedTracks'){legendtext.push('Decades with most played tracks (number of all tracks played at least once)');yLabel.push('number of tracks');querytype.push('getDataDecadesWithMostPlayedTracks');displayChart('Bar');}if(type=='getDataDecadesWithMostPlayedTracksAverage'){legendtext.push('Decades with most played tracks (highest average playcount)');yLabel.push('average playcount');querytype.push('getDataDecadesWithMostPlayedTracksAverage');displayChart('Bar');}if(type=='getDataTracksByDateAdded'){legendtext.push('Tracks by date added');yLabel.push('number of tracks');querytype.push('getDataTracksByDateAdded');displayChart('BarTime');}if(type=='getDataAudioFileFormats'){legendtext.push('Audio file formats of local library tracks');yLabel.push(' number of rated tracks');querytype.push('getDataAudioFileFormats');displayChart('Doughnut');}if(type=='getDataTracksByBitrate'){legendtext.push('Tracks by bit rate (kbps)');yLabel.push('number of tracks');querytype.push('getDataTracksByBitrate');displayChart('Line');}if(type=='getDataTracksByBitrateAudioFileFormat'){legendtext.push('Tracks by bit rate (kbps) and audio file format');yLabel.push('number of tracks');querytype.push('getDataTracksByBitrateAudioFileFormat');displayChart('BarStacked');}if(type=='getDataTracksBySampleRate'){legendtext.push('Sample rates of local library tracks');yLabel.push(' number of tracks');querytype.push('getDataTracksBySampleRate');displayChart('Doughnut');}if(type=='getDataTracksByBitrateAudioFileFormatScatter'){legendtext.push('Tracks by bit rate (kbps) and audio file format');yLabel.push('number of tracks');querytype.push('getDataTracksByBitrateAudioFileFormatScatter');displayChart('Scatter');}if(type=='getDataListeningTimes'){legendtext.push('Tracks by listening time');yLabel.push('number of tracks');querytype.push('getDataListeningTimes');displayChart('Line','listeningtimes');}if(type=='getDataTrackTitleMostFrequentWords'){legendtext.push('Most frequently used words in song titles');yLabel.push('word count');querytype.push('getDataTrackTitleMostFrequentWords');displayChart('Bar');}if(type=='getDataLibStatsText'){querytype.push('getDataLibStatsText');displayChart('Text');}}document.getElementById('toggleswitch_colorscheme').addEventListener('change',function(){if(this.checked){colorSchemeLight=false;document.getElementById('colorscheme_value').innerHTML='dark';}else{colorSchemeLight=true;document.getElementById('colorscheme_value').innerHTML='light';}});document.getElementById('togglebtn_layout').addEventListener('click',function(){if(isHorizontal){SwitchToVertical();}else{SwitchToHorizontal();}},false);document.getElementById('togglebtn_order').addEventListener('click',reverseOrder,false);document.getElementById('togglebtn_datalabels').addEventListener('click',function(chart){var ctx=document.getElementById("chartCanvas").getContext('2d');var thisChart=Chart.getChart(ctx);hideDatalabels(thisChart);},false);function toggleColorSchemeTextOverlay(){var textOverlay=document.getElementById("myNavText");if(colorSchemeLight===false){textOverlay.style.color='rgba(235, 235, 235, 1)';var elements=document.getElementsByClassName('overlay');for(var i=0;i<elements.length;i++){elements[i].style.backgroundColor="rgba(39, 38, 37, 1)";}var elements=document.getElementsByClassName('libstatsTableBody');for(var i=0;i<elements.length;i++){elements[i].style.setProperty("--vstats-color","rgba(235, 235, 235, 1)");}}if(colorSchemeLight===true){textOverlay.style.color='#666';var elements=document.getElementsByClassName('overlay');for(var i=0;i<elements.length;i++){elements[i].style.backgroundColor="rgba(240, 240, 240, 1)";}var elements=document.getElementsByClassName('libstatsTableBody');for(var i=0;i<elements.length;i++){elements[i].style.setProperty("--vstats-color","#666");}}}